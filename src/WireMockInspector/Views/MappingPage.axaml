<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:WireMockInspector.ViewModels"
             xmlns:views="clr-namespace:WireMockInspector.Views"
             xmlns:avalonia="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="viewModels:MainWindowViewModel"
             x:Class="WireMockInspector.Views.MappingPage">
    <views:ContentWithSidebar IsSidebarOpen="{Binding SelectedMapping, Converter={x:Static ObjectConverters.IsNotNull}}">
            <views:ContentWithSidebar.Main>
              <DockPanel LastChildFill="True">
                <Grid ColumnDefinitions="Auto, *" DockPanel.Dock="Top">
                  <ComboBox Width="150" SelectedIndex="{Binding MappingTypeFilter}" Margin="0,0,10,0">
                    <ComboBoxItem IsSelected="True">All</ComboBoxItem>
                    <ComboBoxItem>Perfect match</ComboBoxItem>
                    <ComboBoxItem>Partial match</ComboBoxItem>
                    <ComboBoxItem>Not matched</ComboBoxItem>
                    <ComboBoxItem>Generated by proxy</ComboBoxItem>
                  </ComboBox>
                  <PathIcon Grid.Column="1" HorizontalAlignment="Right" ZIndex="10" Data="{StaticResource search_regular}" Margin="0,0,35,0" ></PathIcon>
                  <TextBox  Text="{Binding MappingSearchTerm}" Grid.Column="1" Margin="0,0,25,0">

                  </TextBox>
                </Grid>

                <ListBox ItemsSource="{Binding FilteredMappings}" SelectedItem="{Binding SelectedMapping}"   Margin="0 20, 10,0" Background="Transparent">
                  <ListBox.Styles>
                    <Style Selector="ListBoxItem">
                      <Setter Property="Padding" Value="0"></Setter>
                      <Setter Property="Margin" Value="0,5,20,5"></Setter>
                      <Setter Property="ClipToBounds" Value="True"></Setter>
                      <Setter Property="CornerRadius" Value="10"></Setter>
                    </Style>
                    <Style Selector="ListBoxItem:selected > ContentPresenter">
                      <Setter Property="Background" Value="#19ffffff"></Setter>
                    </Style>

                  </ListBox.Styles>
                  <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="viewModels:MappingViewModel">
                      <Border CornerRadius="10" ClipToBounds="True" BorderBrush="gray" BorderThickness="2" Margin="0">
                        <Border.Styles>
                          <Style Selector="PathIcon.perfect">
                            <Setter Property="Data" Value="{StaticResource checkmark_circle_regular}"></Setter>
                            <Setter Property="Foreground" Value="green"></Setter>
                          </Style>
                          <Style Selector="PathIcon.partial">
                            <Setter Property="Data" Value="{StaticResource checkmark_circle_regular}"></Setter>
                            <Setter Property="Foreground" Value="orange"></Setter>
                          </Style>
                          <Style Selector="PathIcon.unmatched">
                            <Setter Property="Data" Value="{StaticResource dismiss_circle_regular}"></Setter>
                            <Setter Property="Foreground" Value="red"></Setter>
                          </Style>

                        </Border.Styles>
                        <StackPanel Margin="10" Orientation="Vertical">
                          <Grid ColumnDefinitions="Auto,160,300,*"   >
                            <PathIcon
                                Margin="5,0, 15,0"
                                VerticalAlignment="Center"
                                Classes.perfect="{Binding HitType, Converter={x:Static viewModels:StringMatchConverter.Instance}, ConverterParameter=PerfectMatch}"
                                Classes.partial="{Binding HitType, Converter={x:Static viewModels:StringMatchConverter.Instance}, ConverterParameter=OnlyPartialMatch}"
                                Classes.unmatched="{Binding HitType, Converter={x:Static viewModels:StringMatchConverter.Instance}, ConverterParameter=Unmatched}"
                                            ></PathIcon>
                            <TextBlock Grid.Column="1" Text="{Binding UpdatedOn, StringFormat={}{0:s}}" Foreground="white" VerticalAlignment="Center" ></TextBlock>
                            <SelectableTextBlock Grid.Column="2"  Text="{Binding Id}" Width="300" Foreground="white" VerticalAlignment="Center" Margin="10,0"></SelectableTextBlock>
                            <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                              <Label>Perfect matches:</Label>
                              <TextBlock Text="{Binding PerfectHitCount}" Margin="5,0" VerticalAlignment="Center"></TextBlock>
                              <Label>Partial matches:</Label>
                              <TextBlock Text="{Binding PartialHitCount}" Margin="5,0" VerticalAlignment="Center"></TextBlock>
                            </StackPanel>
                          </Grid>
                          <StackPanel  Orientation="Vertical">
                            <SelectableTextBlock   Text="{Binding Title}" IsVisible="{Binding Title, Converter={x:Static ObjectConverters.IsNotNull}}" Foreground="white" VerticalAlignment="Center" Margin="5,5"></SelectableTextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                              <ItemsControl ItemsSource="{Binding ExpectedMethods}">
                                <ItemsControl.ItemsPanel>
                                  <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left"></StackPanel>
                                  </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                  <DataTemplate>
                                    <Border Width="100"  BorderThickness="2" Margin="5,0" VerticalAlignment="Center" CornerRadius="5" BorderBrush="{Binding  Converter={x:Static viewModels:RequestMethodToColorConverter.Instance}}">
                                      <TextBlock TextAlignment="Center"  Text="{Binding }" Margin="5" Foreground="white"></TextBlock>
                                    </Border>
                                  </DataTemplate>
                                </ItemsControl.ItemTemplate>
                              </ItemsControl>
                              <SelectableTextBlock Text="{Binding ExpectedPaths}"  IsVisible="{Binding ExpectedPaths, Converter={x:Static ObjectConverters.IsNotNull}}" Foreground="white" VerticalAlignment="Center" Margin="5,5"></SelectableTextBlock>
                            </StackPanel>
                            <SelectableTextBlock  Text="{Binding Description}" IsVisible="{Binding Description, Converter={x:Static ObjectConverters.IsNotNull}}" Foreground="white" VerticalAlignment="Center" Margin="5,5"></SelectableTextBlock>
                          </StackPanel>
                        </StackPanel>

                      </Border>
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>
              </DockPanel>
            </views:ContentWithSidebar.Main>
            <views:ContentWithSidebar.Sidebar>
              <TabControl Classes="minor">
                <TabItem Header="Definition">
                  <avalonia:MarkdownScrollViewer Markdown="{Binding SelectedMapping.Content }"></avalonia:MarkdownScrollViewer>
                </TabItem>
                <TabItem Header="Matches">
                  <ScrollViewer>
                    <StackPanel Orientation="Vertical">
                      <Border BorderThickness="0,0,0,1" BorderBrush="#808080" Margin="0,0,0,15">
                        <Label DockPanel.Dock="Left" VerticalAlignment="Center" >Perfect matches</Label>
                      </Border>
                      <views:RequestLogs DataContext="{Binding SelectedMapping.PerfectMatches}"></views:RequestLogs>
                      <Border BorderThickness="0,0,0,1" BorderBrush="#808080" Margin="0,15,0,15">
                        <Label DockPanel.Dock="Left" VerticalAlignment="Center" >Partial matches</Label>
                      </Border>
                      <views:RequestLogs DataContext="{Binding SelectedMapping.PartialMatches}"></views:RequestLogs>
                    </StackPanel>
                  </ScrollViewer>
                </TabItem>
                <TabItem Header="Scenario" IsVisible="{Binding SelectedMapping.Scenario, Converter={x:Static ObjectConverters.IsNotNull}}">
                  <Grid Background="#404040">
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto"></RowDefinition>
                      <RowDefinition Height="*"></RowDefinition>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Vertical" Margin="5">
                      <StackPanel Orientation="Horizontal">
                        <Label>Scenario Name:</Label>
                        <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" FontWeight="Bold" Text="{Binding SelectedMapping.Scenario.ScenarioName}"></TextBlock>
                      </StackPanel>
                      <StackPanel Orientation="Horizontal">
                        <Label>Current State:</Label>
                        <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" FontWeight="Bold" Text="{Binding SelectedMapping.Scenario.CurrentState}" Foreground="#0078d7"></TextBlock>
                      </StackPanel>
                      <StackPanel Orientation="Horizontal">
                        <Label>This mapping transition:</Label>
                        <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" FontWeight="Bold" Text="{Binding SelectedMapping.Scenario.ThisMappingTransition}" Foreground="Orange"></TextBlock>
                      </StackPanel>
                    </StackPanel>
                    <Image Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Source="{Binding SelectedMapping.Scenario, Converter={x:Static  viewModels:GraphConverter.Instance}}"></Image>
                  </Grid>
                </TabItem>
                <TabItem Header="Code">
                  <avalonia:MarkdownScrollViewer Markdown="{Binding SelectedMapping.Code }"></avalonia:MarkdownScrollViewer>
                </TabItem>
              </TabControl>
            </views:ContentWithSidebar.Sidebar>
          </views:ContentWithSidebar>
</UserControl>
